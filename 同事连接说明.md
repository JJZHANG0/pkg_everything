# ğŸ¤– åŒäº‹è¿æ¥è§£å†³æ–¹æ¡ˆ

## ğŸš¨ é—®é¢˜åˆ†æ

ä½ åŒäº‹é‡åˆ°çš„é”™è¯¯ï¼š
```
[ERROR] [1754193381.864667340] [multi_cmd_bot]: WebSocket connection failed: BaseEventLoop.create_connection() got an unexpected keyword argument 'extra_headers', retry after 5 seconds
```

è¿™æ˜¯å› ä¸ºåŒäº‹çš„Python websocketsåº“ç‰ˆæœ¬å¤ªæ—§ï¼Œä¸æ”¯æŒ`extra_headers`å‚æ•°ã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. ä½¿ç”¨é€‚é…ç‰ˆæœ¬ä»£ç 

æˆ‘å·²ç»ä¸ºä½ åŒäº‹ä¿®æ”¹å¥½äº†ä»£ç ï¼Œä¸»è¦æ”¹åŠ¨ï¼š

- **ç§»é™¤ `extra_headers` å‚æ•°**ï¼šæ”¹ä¸ºé€šè¿‡URLæŸ¥è¯¢å‚æ•°ä¼ é€’token
- **å…¼å®¹æ—§ç‰ˆæœ¬websockets**ï¼šä½¿ç”¨æ ‡å‡†çš„è¿æ¥æ–¹å¼
- **æ·»åŠ é”™è¯¯å¤„ç†**ï¼šWebSocketå¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•
- **æ”¯æŒç´§æ€¥æŒ‰é’®**ï¼šæ·»åŠ äº†`emergency_open_door`æŒ‡ä»¤å¤„ç†

### 2. å…³é”®ä¿®æ”¹ç‚¹

```python
# åŸæ¥çš„ä»£ç ï¼ˆæœ‰é—®é¢˜ï¼‰
async with websockets.connect(WS_SERVER_URL, extra_headers=headers) as ws:

# ä¿®æ”¹åçš„ä»£ç ï¼ˆå…¼å®¹ï¼‰
params = urlencode({
    'token': token,
    'robot_id': ROBOT_ID
})
ws_url = f"ws://192.168.110.148:8000/ws/robot/{ROBOT_ID}/?{params}"
self.websocket = await websockets.connect(ws_url)
```

### 3. é…ç½®å‚æ•°

è¯·åŒäº‹ç¡®è®¤ä»¥ä¸‹é…ç½®ï¼š

```python
SERVER_URL = 'http://192.168.110.148:8000/api'  # ä½ çš„æœåŠ¡å™¨IP
ROBOT_ID = 1
USERNAME = 'root'
PASSWORD = 'test123456'
```

## ğŸ“‹ ä½¿ç”¨æ­¥éª¤

### æ­¥éª¤1ï¼šæ›¿æ¢ä»£ç 
è®©åŒäº‹ç”¨æˆ‘æä¾›çš„ `åŒäº‹ä»£ç é€‚é…ç‰ˆæœ¬.py` æ›¿æ¢åŸæ¥çš„ä»£ç ã€‚

### æ­¥éª¤2ï¼šç¡®è®¤ç½‘ç»œè¿æ¥
ç¡®ä¿åŒäº‹çš„æœºå™¨äººèƒ½è®¿é—®ä½ çš„IPåœ°å€ï¼š`192.168.110.148:8000`

### æ­¥éª¤3ï¼šè¿è¡Œæµ‹è¯•
```bash
# åœ¨åŒäº‹çš„æœºå™¨äººä¸Šè¿è¡Œ
python3 åŒäº‹ä»£ç é€‚é…ç‰ˆæœ¬.py
```

## ğŸ”§ æµ‹è¯•è¿æ¥

å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œå¯ä»¥è®©åŒäº‹è¿è¡Œè¿™ä¸ªç®€å•çš„æµ‹è¯•è„šæœ¬ï¼š

```python
#!/usr/bin/env python3
import asyncio
import websockets
import requests

async def test_connection():
    # è·å–token
    response = requests.post(
        "http://192.168.110.148:8000/api/token/",
        json={"username": "root", "password": "test123456"}
    )
    token = response.json().get('access')
    
    # è¿æ¥WebSocket
    ws_url = f"ws://192.168.110.148:8000/ws/robot/1/?token={token}&robot_id=1"
    websocket = await websockets.connect(ws_url)
    print("âœ… è¿æ¥æˆåŠŸ!")
    await websocket.close()

asyncio.run(test_connection())
```

## ğŸ“Š æ”¯æŒçš„æŒ‡ä»¤

ä¿®æ”¹åçš„ä»£ç æ”¯æŒä»¥ä¸‹WebSocketæŒ‡ä»¤ï¼š

1. **`open_door`** - å¼€é—¨
2. **`close_door`** - å…³é—¨  
3. **`upload_qr`** - ä¸Šä¼ äºŒç»´ç å›¾ç‰‡
4. **`navigate`** - å¯¼èˆªåˆ°æŒ‡å®šä½ç½®
5. **`emergency_open_door`** - ç´§æ€¥å¼€é—¨

## ğŸ”„ è‡ªåŠ¨é‡è¿æœºåˆ¶

- WebSocketè¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨é‡è¯•
- æ¯5ç§’é‡è¯•ä¸€æ¬¡
- è‡ªåŠ¨é‡æ–°è·å–token
- å‘é€çŠ¶æ€æ›´æ–°å’ŒæŒ‡ä»¤ç»“æœ

## ğŸ“ æ—¥å¿—æŸ¥çœ‹

åŒäº‹å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹è¿æ¥çŠ¶æ€ï¼š

```bash
# æŸ¥çœ‹ROSæ—¥å¿—
ros2 run your_package your_node

# æˆ–è€…æŸ¥çœ‹Pythonæ—¥å¿—
python3 åŒäº‹ä»£ç é€‚é…ç‰ˆæœ¬.py
```

## ğŸ†˜ æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šè¿æ¥è¶…æ—¶
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- ç¡®è®¤é˜²ç«å¢™è®¾ç½®
- éªŒè¯IPåœ°å€æ˜¯å¦æ­£ç¡®

### é—®é¢˜2ï¼šè®¤è¯å¤±è´¥
- æ£€æŸ¥ç”¨æˆ·åå¯†ç 
- ç¡®è®¤tokenè·å–æ˜¯å¦æˆåŠŸ

### é—®é¢˜3ï¼šWebSocketè¿æ¥å¤±è´¥
- æ£€æŸ¥websocketsåº“ç‰ˆæœ¬
- ç¡®è®¤æœåŠ¡å™¨WebSocketæœåŠ¡æ˜¯å¦å¯åŠ¨

## ğŸ“ è”ç³»ä¿¡æ¯

å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. å…·ä½“çš„é”™è¯¯ä¿¡æ¯
2. ç½‘ç»œè¿æ¥çŠ¶æ€
3. Pythonå’Œwebsocketsåº“ç‰ˆæœ¬

---

**æ³¨æ„**ï¼šè¿™ä¸ªä¿®æ”¹ç‰ˆæœ¬å®Œå…¨å…¼å®¹ä½ çš„WebSocketç³»ç»Ÿï¼ŒåŒäº‹å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼ 