# 🔌 WebSocket系统启动指南

## 📋 当前状态

✅ **系统已成功部署并运行**

- WebSocket服务器正在运行（端口8001）
- 机器人客户端测试通过
- 命令发送功能正常

## 🚀 启动步骤

### 1. 启动WebSocket服务器

**方法1: 使用启动脚本（推荐）**
```bash
./启动WebSocket服务器.sh
```

**方法2: 直接运行**
```bash
python3 websocket_server_final.py
```

### 2. 验证服务器运行

服务器启动后会显示：
```
🚀 启动最终版WebSocket服务器...
📡 监听端口: 8001
🔗 机器人连接地址: ws://localhost:8001/robot/{robot_id}
==================================================
✅ WebSocket服务器启动成功
⏳ 等待机器人连接...
```

### 3. 测试连接

在另一个终端运行：
```bash
python3 robot_test_client.py
```

应该看到：
```
🤖 机器人WebSocket测试客户端
==================================================
📡 服务器地址: ws://localhost:8001/robot/1
🤖 机器人ID: 1
==================================================
🔌 连接到服务器: ws://localhost:8001/robot/1
✅ 连接成功
🤖 机器人客户端启动
💓 发送心跳: 1
📊 发送状态更新: {...}
```

## 🔧 发送命令

### 在服务器终端中直接输入命令：

```
1 open_door          # 向机器人1发送开门命令
1 close_door         # 向机器人1发送关门命令
1 start_delivery     # 向机器人1发送开始配送命令
1 stop_robot         # 向机器人1发送停止命令
1 emergency_open_door # 向机器人1发送紧急开门命令
```

### 特殊命令：
```
help   # 显示帮助信息
status # 查看所有机器人状态
quit   # 退出命令发送
```

## 📁 给同事的文件

**目录**: `给同事的WebSocket测试包/`

**包含文件**：
1. `websocket_server_final.py` - WebSocket服务器
2. `robot_test_client.py` - 机器人测试客户端
3. `start_websocket_test.sh` - 快速启动脚本
4. `requirements.txt` - Python依赖
5. `同事WebSocket测试指南.md` - 详细使用指南
6. `如何发送命令给机器人.md` - 命令发送说明
7. `README.md` - 包说明文件

## 📡 连接信息

- **服务器地址**: `ws://你的服务器IP:8001/robot/{robot_id}`
- **机器人ID**: 1, 2, 3... (可自定义)
- **端口**: 8001

## 🔍 监控和调试

### 查看服务器日志
服务器会输出详细的连接和消息日志：
```
🤖 机器人 1 尝试连接
✅ 机器人 1 连接成功
📥 收到机器人 1 的消息: heartbeat
📤 向机器人 1 发送消息: heartbeat_ack
```

### 查看客户端日志
客户端会显示连接状态和命令执行：
```
🔌 连接到服务器: ws://localhost:8001/robot/1
✅ 连接成功
📥 收到消息: command
🔧 收到命令: open_door
🔧 发送命令结果: success - 门已打开
```

## ❗ 注意事项

1. **端口占用**
   - 确保端口8001未被占用
   - 如果被占用，可以修改服务器代码中的端口号

2. **网络配置**
   - 确保防火墙允许端口8001
   - 同事需要能访问你的服务器IP

3. **依赖要求**
   - Python 3.7+
   - websockets库

## 🔄 故障排除

### 常见问题：

1. **端口被占用**
   ```bash
   # 查看端口占用
   lsof -i :8001
   
   # 杀死占用进程
   kill -9 <进程ID>
   ```

2. **websockets库未安装**
   ```bash
   pip3 install websockets
   ```

3. **连接失败**
   - 检查服务器是否启动
   - 检查网络连接
   - 检查防火墙设置

## ✅ 总结

**你这边需要启动**：
- `websocket_server_final.py` - WebSocket服务器

**给同事的文件**：
- `给同事的WebSocket测试包/` 目录下的所有文件

**测试流程**：
1. 启动服务器
2. 同事运行客户端
3. 在服务器终端发送命令
4. 观察客户端响应

---

**状态**: ✅ 系统正常运行，可以开始测试 