# 🔴 实时WebSocket日志查看指南

## 🚀 快速启动

### 方法1：使用自动脚本（推荐）
```bash
# 启动实时日志监控窗口
./start_live_logs.sh
```

### 方法2：手动启动
```bash
# 直接在当前窗口查看
cd docker_deploy
docker-compose exec backend tail -f /app/logs/websocket_events.log
```

## 📋 Screen窗口管理

### 查看所有窗口
```bash
screen -ls
```

### 连接到日志窗口
```bash
screen -r websocket-logs
```

### 分离窗口（保持运行）
在screen窗口中按：`Ctrl+A` 然后按 `D`

### 关闭窗口
```bash
screen -S websocket-logs -X quit
```

## 🔍 不同类型的日志监控

### 1. 重要事件日志（推荐）
```bash
# 在screen窗口中运行
docker-compose exec backend tail -f /app/logs/websocket_events.log
```

### 2. 详细调试日志
```bash
# 在screen窗口中运行
docker-compose exec backend tail -f /app/logs/websocket_detailed.log
```

### 3. 系统后端日志
```bash
# 在screen窗口中运行
docker-compose exec backend tail -f /app/logs/system_backend.log
```

### 4. 过滤特定机器人
```bash
# 只查看Robot-1的日志
docker-compose exec backend tail -f /app/logs/websocket_events.log | grep "Robot-1:"
```

## 📊 日志内容说明

### 🔗 连接事件
```
✅ [Robot-1:快递小车1] CONNECTION_ESTABLISHED: WebSocket连接已建立
🔌 [Robot-1:快递小车1] CONNECTION_CLOSED: WebSocket连接已关闭
❌ [Robot-1:快递小车1] CONNECTION_FAILED: WebSocket连接失败
```

### 💬 消息事件
```
📥 [Robot-1:快递小车1] MESSAGE_RECEIVED: 收到消息 | Type: status_update
📤 [Robot-1:快递小车1] MESSAGE_SENT: 发送消息 | Type: command
```

### ⚡ 指令执行
```
⚡ [Robot-1:快递小车1] COMMAND_EXECUTED: 指令执行完成 | Command: open_door | Result: door_open
💥 [Robot-1:快递小车1] COMMAND_FAILED: 指令执行失败 | Command: open_door | Error: 硬件故障
```

### 💓 心跳消息
```
💓 [Robot-1:快递小车1] HEARTBEAT: 收到心跳
```

### 🚨 错误日志
```
🚨 [Robot-1:快递小车1] ERROR: 发生错误: 消息格式错误
```

## 🛠️ 实用技巧

### 1. 多窗口监控
```bash
# 创建多个screen窗口监控不同类型的日志
screen -dmS events-logs bash -c "docker-compose exec backend tail -f /app/logs/websocket_events.log"
screen -dmS detailed-logs bash -c "docker-compose exec backend tail -f /app/logs/websocket_detailed.log"
screen -dmS system-logs bash -c "docker-compose exec backend tail -f /app/logs/system_backend.log"
```

### 2. 实时统计
```bash
# 在另一个窗口中运行统计命令
screen -dmS stats bash -c "while true; do python view_websocket_logs.py --stats; sleep 30; done"
```

### 3. 错误监控
```bash
# 只监控错误日志
docker-compose exec backend tail -f /app/logs/websocket_events.log | grep "ERROR\|FAILED"
```

### 4. 性能监控
```bash
# 监控性能指标
docker-compose exec backend tail -f /app/logs/websocket_detailed.log | grep "PERFORMANCE"
```

## 📱 快捷键参考

### Screen快捷键
- `Ctrl+A` + `D` - 分离窗口
- `Ctrl+A` + `C` - 创建新窗口
- `Ctrl+A` + `N` - 切换到下一个窗口
- `Ctrl+A` + `P` - 切换到上一个窗口
- `Ctrl+A` + `"` - 显示窗口列表
- `Ctrl+A` + `?` - 显示帮助

### 日志过滤快捷键
- `Ctrl+C` - 停止监控
- `Ctrl+S` - 暂停输出
- `Ctrl+Q` - 恢复输出

## 🔧 故障排除

### 1. 窗口无法连接
```bash
# 检查screen会话
screen -ls

# 强制重新连接
screen -r websocket-logs -D
```

### 2. 日志文件不存在
```bash
# 检查日志文件
docker-compose exec backend ls -la /app/logs/websocket_*.log

# 重启后端服务
docker-compose restart backend
```

### 3. 日志不更新
```bash
# 检查WebSocket连接
python simple_websocket_test.py

# 检查后端状态
docker-compose ps
```

## 💡 最佳实践

1. **保持窗口运行**：使用 `Ctrl+A` + `D` 分离窗口，让日志监控在后台运行
2. **定期检查**：每天检查一次错误日志
3. **多窗口监控**：同时监控不同类型的事件
4. **设置告警**：为重要错误设置通知
5. **日志轮转**：定期清理旧日志文件

## 🎯 常用命令总结

```bash
# 启动实时监控
./start_live_logs.sh

# 连接到监控窗口
screen -r websocket-logs

# 查看统计信息
python view_websocket_logs.py --stats

# 查看性能指标
python view_websocket_logs.py --performance

# 查看错误日志
python view_websocket_logs.py --errors 24

# 停止监控
screen -S websocket-logs -X quit
```

现在你可以轻松地在专门的窗口中实时监控WebSocket日志了！🎉 