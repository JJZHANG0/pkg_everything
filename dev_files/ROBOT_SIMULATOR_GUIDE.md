# 🤖 机器人模拟器使用指南

## 📋 概述

这个机器人模拟器允许你在Windows电脑上模拟机器人，与服务器进行通信测试。通过这个模拟器，你可以测试所有的机器人控制API，确保在实际的快递小车上部署时能够正常工作。

## 🚀 快速开始

### 1. 环境准备

在Windows电脑上安装Python和必要的依赖：

```bash
# 安装Python (如果还没有安装)
# 下载地址: https://www.python.org/downloads/

# 安装依赖
pip install requests
```

### 2. 下载脚本

将以下文件下载到Windows电脑上：
- `robot_simulator_windows.py` - 完整的机器人模拟器
- `robot_test_script_windows.py` - API测试脚本
- `test_connection.py` - 连接测试脚本

### 3. 配置服务器信息

**服务器IP地址**: `192.168.110.148` (你的Mac电脑IP)
**服务器端口**: `8000`
**机器人ID**: `1` (默认)
**用户名**: `root`
**密码**: `test123456`

### 4. 连接测试

首先运行连接测试脚本，确保网络连接正常：

```bash
python test_connection.py
```

如果连接测试成功，你会看到类似这样的输出：
```
🔗 测试连接到: http://192.168.110.148:8000/api
==================================================
✅ 服务器可达: 200
✅ 登录成功: root
   访问令牌: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
✅ 获取机器人信息成功
   机器人名称: Robot-001
   机器人状态: IDLE
✅ 获取指令成功，共 0 条待执行指令

🎉 连接测试成功！
现在可以运行机器人模拟器了
```

## 🎯 使用方法

### 方法一：完整机器人模拟器

运行完整的机器人模拟器，它会持续轮询服务器获取指令：

```bash
python robot_simulator_windows.py
```

**功能特点**:
- 自动登录服务器
- 持续轮询待执行指令
- 模拟指令执行过程
- 实时显示机器人状态
- 自动报告执行结果

**使用流程**:
1. 启动模拟器
2. 在服务器端（你的Mac）发送控制指令
3. 观察Windows电脑上的模拟器响应
4. 验证指令是否正确执行

### 方法二：API测试脚本

运行API测试脚本，手动测试各种功能：

```bash
python robot_test_script_windows.py
```

**功能特点**:
- 交互式菜单
- 手动选择测试项目
- 详细的API响应信息
- 支持完整测试流程

## 🔧 故障排除

### 常见问题

**1. 连接失败**
```
❌ 服务器不可达: Connection refused
```
**解决方案**: 
- 检查服务器IP地址是否正确
- 确保服务器正在运行
- 检查防火墙设置

**2. 认证失败**
```
❌ 登录失败: 401
```
**解决方案**: 
- 确认用户名: `root`
- 确认密码: `test123456`
- 检查服务器上的用户是否存在

**3. 网络连接问题**
```
❌ 测试异常: timeout
```
**解决方案**:
- 检查两台电脑是否在同一网络
- 尝试ping服务器IP地址
- 检查路由器设置

### 调试步骤

1. **测试网络连通性**:
   ```bash
   ping 192.168.110.148
   ```

2. **测试端口连通性**:
   ```bash
   telnet 192.168.110.148 8000
   ```

3. **运行连接测试**:
   ```bash
   python test_connection.py
   ```

4. **查看详细错误信息**:
   如果登录失败，脚本会显示详细的错误响应

## 📡 测试的API功能

### 1. 获取待执行指令
```http
GET /api/robots/{robot_id}/get_commands/
```
- 机器人轮询获取服务器发送的指令
- 返回所有状态为`PENDING`的指令

### 2. 执行指令并报告结果
```http
POST /api/robots/{robot_id}/execute_command/
```
- 机器人执行指令后向服务器报告结果
- 服务器更新指令状态为`COMPLETED`

### 3. 到达目的地
```http
POST /api/robots/{robot_id}/arrived_at_destination/
```
- 将订单状态从`DELIVERING`更新为`DELIVERED`
- 开始等待用户扫描二维码

### 4. 扫描二维码
```http
POST /api/robots/{robot_id}/qr_scanned/
```
- 验证二维码数据
- 将订单状态从`DELIVERED`更新为`PICKED_UP`

### 5. 自动返航
```http
POST /api/robots/{robot_id}/auto_return/
```
- 处理超时未取的包裹
- 将所有`DELIVERED`状态的订单更新为`CANCELLED`

## 🔧 支持的指令类型

| 指令类型 | 中文名称 | 模拟执行过程 |
|---------|---------|-------------|
| `open_door` | 开门 | 显示"正在开门..."，2秒后更新门状态为OPEN |
| `close_door` | 关门 | 显示"正在关门..."，2秒后更新门状态为CLOSED |
| `start_delivery` | 开始配送 | 显示"开始配送..."，3秒后更新状态为DELIVERING |
| `stop_robot` | 停止机器人 | 显示"停止机器人..."，2秒后更新状态为IDLE |
| `arrived_at_destination` | 到达目的地 | 显示"到达目的地..."，2秒后更新状态为WAITING |
| `auto_return` | 自动返航 | 显示"自动返航..."，3秒后更新状态为RETURNING |

## 📊 机器人状态显示

模拟器会实时显示机器人的当前状态：

```
📊 当前状态:
   状态: IDLE
   门: CLOSED
   位置: ORIGIN
   电量: 100%
```

## 🎮 测试场景示例

### 场景1：基本控制测试
1. 在服务器端发送"开门"指令
2. 观察Windows模拟器显示"正在开门..."
3. 验证门状态更新为"OPEN"
4. 检查服务器端指令状态是否更新为"COMPLETED"

### 场景2：配送流程测试
1. 在服务器端发送"开始配送"指令
2. 观察模拟器状态变化
3. 测试"到达目的地"功能
4. 测试"扫描二维码"功能
5. 测试"自动返航"功能

### 场景3：错误处理测试
1. 尝试执行不存在的指令ID
2. 测试网络断开情况
3. 验证错误信息的正确显示

## 📈 性能测试

### 并发测试
可以同时运行多个模拟器实例，测试服务器的并发处理能力：

```bash
# 终端1
python robot_simulator_windows.py

# 终端2
python robot_simulator_windows.py
```

### 压力测试
修改轮询间隔，测试服务器的响应能力：

```python
# 在robot_simulator_windows.py中修改
time.sleep(1)  # 改为1秒轮询一次
```

## 🚀 部署到实际机器人

当Windows模拟器测试通过后，可以将相同的逻辑部署到实际的快递小车上：

1. **硬件要求**:
   - 支持Python的嵌入式设备（如树莓派）
   - 网络连接模块
   - 传感器和执行器

2. **软件适配**:
   - 将模拟的指令执行替换为实际的硬件控制
   - 添加传感器数据读取
   - 实现实际的运动控制

3. **安全考虑**:
   - 添加硬件安全检查
   - 实现紧急停止功能
   - 添加故障恢复机制

## 📞 技术支持

如果在使用过程中遇到问题，请按以下顺序检查：

1. **网络连接**:
   - 运行 `ping 192.168.110.148`
   - 运行 `python test_connection.py`

2. **服务器状态**:
   - 确保服务器正在运行
   - 检查Docker容器状态

3. **认证信息**:
   - 用户名: `root`
   - 密码: `test123456`

4. **API接口**:
   - 检查API文档
   - 验证请求格式

通过这个模拟器，你可以充分测试所有的机器人控制功能，确保在实际部署时能够稳定可靠地工作！ 