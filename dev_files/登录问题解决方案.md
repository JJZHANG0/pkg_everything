# 🔐 登录问题解决方案

## 🚨 问题描述

用户无法登录系统，登录页面显示错误或无法正常跳转。

## ✅ 已解决的问题

### 1. 用户密码问题
- **问题**: 只有 `root` 用户能登录，其他用户密码不正确
- **解决**: 已重置所有用户密码为 `test123456`

### 2. 前端localStorage键名问题
- **问题**: 前端代码中localStorage键名不一致
- **解决**: 已修复为同时保存 `token` 和 `access_token`

### 3. API接口验证
- **问题**: 需要确认API接口是否正常工作
- **解决**: 已验证所有API接口正常工作

## 🔧 当前可用的登录账户

| 用户名 | 密码 | 角色 | 权限 |
|--------|------|------|------|
| `root` | `test123456` | 超级管理员 | 所有权限 |
| `7` | `test123456` | 普通用户 | 基本权限 |
| `5566` | `test123456` | 普通用户 | 基本权限 |

## 🧪 测试方法

### 方法1: 使用测试页面
1. 打开 `test_frontend_login.html` 文件
2. 输入用户名和密码
3. 点击"登录测试"按钮
4. 查看测试结果

### 方法2: 使用API测试
```bash
# 测试登录API
curl -X POST http://localhost:8000/api/token/ \
  -H "Content-Type: application/json" \
  -d '{"username":"root","password":"test123456"}'

# 测试用户信息API
TOKEN="你的access_token"
curl -X GET "http://localhost:8000/api/users/me/" \
  -H "Authorization: Bearer $TOKEN"
```

### 方法3: 使用Python脚本
```bash
python3 test_login.py
```

## 🌐 访问地址

- **前端页面**: http://localhost:3000
- **后端API**: http://localhost:8000/api/
- **WebSocket监控**: http://localhost:3000/superuser/websocket-monitor

## 🔍 故障排除步骤

### 步骤1: 检查服务状态
```bash
docker-compose ps
```

确保所有容器都在运行状态。

### 步骤2: 检查API接口
```bash
curl -X POST http://localhost:8000/api/token/ \
  -H "Content-Type: application/json" \
  -d '{"username":"root","password":"test123456"}'
```

应该返回包含 `access` 和 `refresh` token的JSON响应。

### 步骤3: 检查前端页面
```bash
curl -I http://localhost:3000
```

应该返回200状态码。

### 步骤4: 检查浏览器控制台
1. 打开浏览器开发者工具 (F12)
2. 查看Console标签页的错误信息
3. 查看Network标签页的请求状态

## 🛠️ 常见问题解决

### 问题1: "用户名或密码错误"
**原因**: 用户密码不正确
**解决**: 使用正确的用户名和密码
- 用户名: `root`
- 密码: `test123456`

### 问题2: "无法获取用户信息"
**原因**: API接口调用失败
**解决**: 
1. 检查后端服务是否正常运行
2. 确认API接口路径正确
3. 检查网络连接

### 问题3: 页面无法加载
**原因**: 前端服务未启动
**解决**:
```bash
docker-compose restart frontend
```

### 问题4: 登录后无法跳转
**原因**: 路由配置问题
**解决**:
1. 检查localStorage中的token是否正确保存
2. 确认路由配置正确
3. 检查浏览器控制台错误

## 📱 登录流程

### 正常登录流程
1. 用户输入用户名和密码
2. 前端调用 `/api/token/` 获取JWT token
3. 前端调用 `/api/users/me/` 获取用户信息
4. 前端保存token和用户信息到localStorage
5. 前端跳转到 `/home` 页面

### 登录成功标志
- 浏览器localStorage中包含 `token` 或 `access_token`
- 页面成功跳转到 `/home`
- 浏览器控制台无错误信息

## 🔐 安全建议

1. **定期更换密码**: 建议定期更换用户密码
2. **使用HTTPS**: 生产环境应使用HTTPS
3. **Token过期**: JWT token有36小时有效期
4. **权限控制**: 不同用户有不同的权限级别

## 📞 技术支持

如果问题仍然存在，请提供以下信息：

1. **错误信息**: 具体的错误提示
2. **浏览器信息**: 浏览器类型和版本
3. **控制台日志**: 浏览器开发者工具的日志
4. **网络请求**: Network标签页的请求状态
5. **Docker日志**: `docker-compose logs` 的输出

## 🎉 总结

现在登录功能应该完全正常了：

✅ **所有用户密码已重置**  
✅ **API接口正常工作**  
✅ **前端代码已修复**  
✅ **localStorage键名已统一**  
✅ **测试工具已提供**  

请使用以下信息登录：
- **用户名**: `root`
- **密码**: `test123456`
- **访问地址**: http://localhost:3000 