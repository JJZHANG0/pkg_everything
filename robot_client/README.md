# CulverBot 快递车客户端

这是一个用于模拟快递车（机器人）的Python客户端，可以在Mac上模拟Raspberry Pi的功能，包括摄像头二维码识别、硬件控制等。

## 🚀 新功能特性

### 📱 增强版GUI界面
- **更大屏幕**: 1600x1000像素，提供更好的视觉体验
- **实时连接**: 与后端系统实时通信，每5秒轮询一次
- **实时二维码检测**: 使用摄像头进行实时二维码扫描
- **连接状态监控**: 显示与服务器的连接状态
- **订单实时更新**: 当后端订单状态变化时，界面会实时更新

### 🔍 实时二维码测试
- **实时摄像头**: 使用笔记本电脑摄像头进行实时二维码扫描
- **动态二维码生成**: 可以生成随机的订单二维码进行测试
- **可视化界面**: 显示扫描到的二维码数据

### 🎮 交互式测试工具
- **后端模拟器**: 模拟后端系统的订单状态变化
- **实时数据流**: 测试客户端与后端的实时通信
- **完整流程测试**: 模拟完整的快递配送流程

## 📁 项目结构

```
robot_client/
├── main_gui.py              # 增强版GUI主程序
├── main.py                  # 命令行版本主程序
├── config.py                # 配置文件
├── requirements.txt         # 依赖包
├── env.example             # 环境变量示例
├── test_backend_simulation.py  # 后端模拟器
├── real_time_qr_test.py    # 实时二维码测试工具
├── utils/
│   └── logger.py           # 日志工具
├── hardware/
│   ├── gpio_controller.py  # GPIO控制器（模拟）
│   └── camera_scanner.py   # 摄像头扫描器
└── network/
    └── api_client.py       # API客户端
```

## 🛠️ 安装和运行

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 配置环境变量
```bash
cp env.example .env
# 编辑.env文件，设置服务器地址等
```

### 3. 运行增强版GUI
```bash
python main_gui.py
```

### 4. 运行后端模拟器
```bash
python test_backend_simulation.py
```

### 5. 运行二维码测试工具
```bash
python real_time_qr_test.py
```

## 🎯 使用指南

### 增强版GUI界面

#### 界面布局
- **左侧**: 控制按钮（装货、配送、紧急停止、开门、关门、实时二维码、摄像头开关）
- **右上**: 系统状态面板（状态、订单数量、连接状态、最后轮询时间）
- **右中**: 订单信息面板（显示当前订单详情）
- **右下**: 摄像头面板（实时摄像头画面）
- **中下**: 系统日志面板（实时操作日志）
- **底部**: 帮助面板（操作说明）

#### 键盘快捷键
- `L` - 装货
- `D` - 开始配送
- `E` - 紧急停止
- `O` - 开门
- `C` - 关门
- `R` - 实时二维码检测
- `V` - 切换摄像头显示
- `ESC` - 退出程序

#### 实时功能
1. **服务器轮询**: 每5秒自动查询后端系统
2. **订单更新**: 实时显示订单状态变化
3. **连接监控**: 显示与服务器的连接状态
4. **实时二维码**: 使用摄像头进行实时二维码扫描

### 后端模拟器

#### 功能
- 模拟后端系统的订单状态变化
- 测试客户端的实时响应能力
- 模拟完整的快递配送流程

#### 使用方法
1. 运行 `python test_backend_simulation.py`
2. 选择要模拟的操作：
   - 测试连接
   - 添加新订单
   - 更改订单状态
   - 运行完整模拟

### 实时二维码测试工具

#### 功能
- 生成测试用的二维码
- 显示二维码数据
- 保存二维码图片

#### 使用方法
1. 运行 `python real_time_qr_test.py`
2. 使用键盘控制：
   - `SPACE` - 生成新二维码
   - `R` - 生成随机数据
   - `S` - 保存二维码
   - `ESC` - 退出

## 🔧 配置说明

### 环境变量 (.env)
```
SERVER_URL=http://localhost:8000/api/
ROBOT_ID=1
POLL_INTERVAL=5
LOG_LEVEL=INFO
CAMERA_INDEX=0
QR_SCAN_INTERVAL=1
```

### 主要配置项
- `SERVER_URL`: 后端API服务器地址
- `ROBOT_ID`: 机器人ID
- `POLL_INTERVAL`: 轮询间隔（秒）
- `CAMERA_INDEX`: 摄像头索引（0为默认摄像头）

## 🎮 测试场景

### 场景1: 完整配送流程测试
1. 启动增强版GUI: `python main_gui.py`
2. 启动后端模拟器: `python test_backend_simulation.py`
3. 在模拟器中选择"运行完整模拟"
4. 观察GUI界面的实时更新

### 场景2: 实时二维码测试
1. 启动增强版GUI: `python main_gui.py`
2. 启动二维码测试工具: `python real_time_qr_test.py`
3. 在GUI中按`R`键启动实时二维码检测
4. 在二维码工具中生成二维码
5. 观察GUI中的二维码扫描结果

### 场景3: 摄像头测试
1. 启动增强版GUI: `python main_gui.py`
2. 按`V`键切换摄像头显示
3. 观察实时摄像头画面

## 🐛 故障排除

### 摄像头问题
- 确保摄像头权限已授予
- 检查摄像头是否被其他程序占用
- 尝试不同的摄像头索引

### 连接问题
- 检查后端服务器是否运行
- 确认网络连接正常
- 检查防火墙设置

### 依赖问题
- 确保所有依赖包已正确安装
- 检查Python版本兼容性
- 重新安装依赖包

## 📝 开发说明

### 添加新功能
1. 在相应的模块中添加功能代码
2. 更新GUI界面以支持新功能
3. 添加相应的测试用例
4. 更新文档

### 调试模式
- 设置 `LOG_LEVEL=DEBUG` 获取详细日志
- 使用 `print` 语句进行调试
- 检查日志文件获取错误信息

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目！

## 📄 许可证

本项目采用MIT许可证。 